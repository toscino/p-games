<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect 4</title>

    <!-- All CSS goes inside this <style> tag -->
    <style>
        /* Basic page styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f7ff;
            color: #333;
            padding: 1rem;
            box-sizing: border-box;
        }

        h1 {
            color: #005a8f;
            margin-top: 0;
        }

        /* Status message (whose turn, who won) */
        #status {
            font-size: 1.5rem;
            font-weight: bold;
            height: 2rem; /* Reserve space to prevent layout shift */
            margin-bottom: 1rem;
        }

        /* The game board grid */
        #board {
            display: grid;
            /* 6 rows, 7 columns */
            /* We use calc() to make it responsive on smaller screens */
            grid-template-rows: repeat(6, max(40px, min(80px, 10vw)));
            grid-template-columns: repeat(7, max(40px, min(80px, 10vw)));
            
            /* This is the classic "blue" board color */
            background-color: #0077be; 
            
            border: 10px solid #005a8f;
            border-radius: 10px;
            padding: 10px;
            gap: 10px; /* This creates the space between the holes */
        }

        /* The individual cells/holes */
        .cell {
            width: 100%;
            height: 100%;
            
            /* This makes the empty holes white */
            background-color: #ffffff; 
            border-radius: 50%; /* Makes them circles */
            cursor: pointer;
            transition: background-color 0.2s;
        }

        /* Style for a cell taken by Player 1 (Red) */
        .cell.player1 {
            background-color: #d90429;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.2);
        }

        /* Style for a cell taken by Player 2 (Yellow) */
        .cell.player2 {
            background-color: #ffde00;
            box-shadow: inset 0 -4px 8px rgba(0,0,0,0.2);
        }

        /* Button styling */
        #resetButton {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1em;
            font-weight: bold;
            color: white;
            background-color: #0077be;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #resetButton:hover {
            background-color: #005a8f;
        }
    </style>
</head>

<body>

    <h1>Connect 4</h1>
    
    <!-- This h2 will show whose turn it is or who won -->
    <h2 id="status">Player 1's Turn (Red)</h2>
    
    <!-- The game board will be generated by JavaScript inside this div -->
    <div id="board"></div>
    
    <button id="resetButton">Reset Game</button>

    <!-- All JavaScript goes inside this <script> tag -->
    <script>
        // Wait for the DOM to be fully loaded before running the game script
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Constants ---
            const ROWS = 6;
            const COLS = 7;
            const PLAYER_1 = 'player1';
            const PLAYER_2 = 'player2';

            // --- Game State Variables ---
            let board = []; // 2D array to track game state
            let currentPlayer = PLAYER_1;
            let gameOver = false;

            // --- DOM Elements ---
            const boardElement = document.getElementById('board');
            const statusElement = document.getElementById('status');
            const resetButton = document.getElementById('resetButton');

            // --- Functions ---

            /**
             * Creates the 2D array for the game logic and
             * creates the HTML elements for the board UI.
             */
            function createBoard() {
                board = []; // Reset the internal board state
                boardElement.innerHTML = ''; // Clear the visual board
                
                for (let r = 0; r < ROWS; r++) {
                    const row = [];
                    for (let c = 0; c < COLS; c++) {
                        // Logic board
                        row.push(null); // null means empty
                        
                        // Visual board
                        const cell = document.createElement('div');
                        cell.classList.add('cell');
                        
                        // Use data-attributes to know which cell was clicked
                        cell.dataset.row = r;
                        cell.dataset.col = c;
                        
                        cell.addEventListener('click', handleCellClick);
                        boardElement.appendChild(cell);
                    }
                    board.push(row);
                }
            }

            /**
             * Handles what happens when a player clicks on a cell.
             */
            function handleCellClick(event) {
                if (gameOver) return; // Stop if game is already won

                const col = parseInt(event.target.dataset.col);
                
                // Find the lowest empty row in this column
                for (let r = ROWS - 1; r >= 0; r--) {
                    if (board[r][col] === null) {
                        // Found an empty spot
                        
                        // 1. Update the logic board
                        board[r][col] = currentPlayer;
                        
                        // 2. Update the visual board
                        const cell = document.querySelector(`[data-row='${r}'][data-col='${col}']`);
                        cell.classList.add(currentPlayer);
                        
                        // 3. Check for a win
                        if (checkWin(r, col)) {
                            gameOver = true;
                            statusElement.textContent = `Player ${currentPlayer === PLAYER_1 ? '1 (Red)' : '2 (Yellow)'} Wins!`;
                            return;
                        }
                        
                        // 4. Check for a draw
                        if (checkDraw()) {
                            gameOver = true;
                            statusElement.textContent = "It's a Draw!";
                            return;
                        }

                        // 5. Switch to the other player
                        switchPlayer();
                        
                        return; // Exit function after placing a piece
                    }
                }
            }

            /**
             * Switches the currentPlayer variable and updates the status message.
             */
            function switchPlayer() {
                currentPlayer = (currentPlayer === PLAYER_1) ? PLAYER_2 : PLAYER_1;
                statusElement.textContent = `Player ${currentPlayer === PLAYER_1 ? '1 (Red)' : '2 (Yellow)'}'s Turn`;
            }

            /**
             * Checks for a 4-in-a-row starting from the last piece placed.
             */
            function checkWin(r, c) {
                const player = board[r][c];

                // Helper function to check a single line
                // (dr, dc) are the "direction deltas":
                // (0, 1) = horizontal, (1, 0) = vertical, (1, 1) = diag down-right, (1, -1) = diag down-left
                const checkLine = (dr, dc) => {
                    let count = 0;
                    // Check 3 spots in one direction and 3 in the opposite
                    for (let i = -3; i <= 3; i++) {
                        if (i === 0) continue; // Skip the piece itself (it's checked by i=-1/i=1)

                        const newR = r + i * dr;
                        const newC = c + i * dc;
                        
                        // Check if cell is on the board
                        if (newR >= 0 && newR < ROWS && newC >= 0 && newC < COLS) {
                            if (board[newR][newC] === player) {
                                count++;
                            } else {
                                // Reset count if the line is broken *in this direction*
                                // We check from the center out, so we need to be careful
                                // A simpler, but less efficient way, is to check four separate times
                                count = 0;
                            }
                            if (count === 3) return true; // Found 3 *others* in a row + the one placed = 4
                        }
                    }
                    return false;
                };

                // A simpler, more readable win-check
                const checkDirection = (dr, dc) => {
                    let count = 0;
                    for(let i = 1; i < 4; i++) { // Check 3 spots in one direction
                        const newR = r + i * dr;
                        const newC = c + i * dc;
                        if(newR < 0 || newR >= ROWS || newC < 0 || newC >= COLS || board[newR][newC] !== player) break;
                        count++;
                    }
                    return count;
                }

                const checkAllDirections = () => {
                    const player = board[r][c];

                    // Check horizontal (left + right)
                    if (checkDirection(0, -1) + checkDirection(0, 1) >= 3) return true;
                    // Check vertical (down)
                    if (checkDirection(1, 0) >= 3) return true;
                    // Check diagonal (down-left + up-right)
                    if (checkDirection(1, -1) + checkDirection(-1, 1) >= 3) return true;
                    // Check diagonal (down-right + up-left)
                    if (checkDirection(1, 1) + checkDirection(-1, -1) >= 3) return true;

                    return false;
                }

                return checkAllDirections();
            }

            /**
             * Checks if the board is full (no null values).
             */
            function checkDraw() {
                // Check the top row. If it's full, the board is full.
                for (let c = 0; c < COLS; c++) {
                    if (board[0][c] === null) {
                        return false; // Found an empty cell, not a draw
                    }
                }
                return true; // No empty cells in the top row, it's a draw
            }

            /**
             * Resets the game to its initial state.
             */
            function resetGame() {
                gameOver = false;
                currentPlayer = PLAYER_1;
                statusElement.textContent = "Player 1's Turn (Red)";
                createBoard();
            }


            // --- Event Listeners ---
            resetButton.addEventListener('click', resetGame);

            // --- Game Initialization ---
            createBoard(); // Create the board when the page loads
        
        }); // End of DOMContentLoaded
    </script>
</body>
</html>